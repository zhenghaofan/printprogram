define(["jquery","app/Stage","object/Line","app/Util"],function(e,t,n,r){var i=function(n){var i=this;i.parent=n,i.name="addline",i.newLine=null,i.x=0,i.y=0,i.onmousedown=function(){var n=t.curDoc();n&&(r.Event.dispatch("beforeAddLine",this),i.x=t.mouseX(),i.y=t.mouseY(),i.newLine=n.addLine(),i.newLine.offsetX(i.x),i.newLine.offsetY(i.y),e(document).on("mousemove",i.onmousemove),e(document).one("mouseup",i.onmouseup))},i.onmousemove=function(){var e=i.newLine,n=Math.abs(i.x-t.mouseX()),r=Math.abs(i.y-t.mouseY());n<r?(e.lineType("v"),e.offsetX(i.x),e.offsetY(Math.min(i.y,t.mouseY())),e.lineLength(r)):(e.lineType("h"),e.offsetX(Math.min(i.x,t.mouseX())),e.offsetY(i.y),e.lineLength(n)),i.newLine.updateCanvas()},i.onmouseup=function(){e(document).off("mousemove",i.onmousemove),t.updateCanvas(),r.Event.dispatch("afterAddLine",this),i.setDefaultTool()},i.setDefaultTool=function(){i.parent.setDefaultTool()},i.active=function(){e(t.cvs).on("mousedown",i.onmousedown)},i.deactive=function(){e(t.cvs).off("mousedown",i.onmousedown)}};return i});