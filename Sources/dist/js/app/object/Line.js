define(["knockout","mapping"],function(e,t){var n=10,r=function(r,i){var s=this;s.cvs=document.createElement("canvas"),s.ctx=s.cvs.getContext("2d"),s.id=null,s.parent=r,s.name=e.observable("线条"),s.type="line",s.zIndex=e.observable(0),s.offsetX=e.observable(50),s.offsetY=e.observable(50),s.angle=e.observable(0),s.ratio=e.observable(1),s.selected=e.observable(!1),s.lineType=e.observable("h"),s.lineLength=e.observable(1e3),s.lineWidth=e.observable(2),s.lineColor=e.observable("#000000"),s.canvasWidth=e.computed(function(){return s.lineType()=="h"?s.lineLength():s.lineWidth()}),s.canvasHeight=e.computed(function(){return s.lineType()=="h"?s.lineWidth():s.lineLength()}),s.UI_INFO=e.computed({read:function(){if(s.lineType()=="h")return s.lineWidth()>=n?{UI_LEFT_TOP_X:s.offsetX(),UI_LEFT_TOP_Y:s.offsetY(),UI_RIGHT_BOTTOM_X:s.offsetX()+s.lineLength(),UI_RIGHT_BOTTOM_Y:s.offsetY()+s.lineWidth(),UI_TYPE:"horizontal"}:{UI_LEFT_TOP_X:s.offsetX(),UI_LEFT_TOP_Y:s.offsetY()-(n-s.lineWidth())/2,UI_RIGHT_BOTTOM_X:s.offsetX()+s.lineLength(),UI_RIGHT_BOTTOM_Y:s.offsetY()+s.lineWidth()+(n-s.lineWidth())/2,UI_TYPE:"horizontal"};if(s.lineType()=="v")return s.lineWidth()>=n?{UI_LEFT_TOP_X:s.offsetX(),UI_LEFT_TOP_Y:s.offsetY(),UI_RIGHT_BOTTOM_X:s.offsetX()+s.lineWidth(),UI_RIGHT_BOTTOM_Y:s.offsetY()+s.lineLength(),UI_TYPE:"vertical"}:{UI_LEFT_TOP_X:s.offsetX()-(n-s.lineWidth())/2,UI_LEFT_TOP_Y:s.offsetY(),UI_RIGHT_BOTTOM_X:s.offsetX()+s.lineWidth()+(n-s.lineWidth())/2,UI_RIGHT_BOTTOM_Y:s.offsetY()+s.lineLength(),UI_TYPE:"vertical"}},write:function(e){s.lineType()=="h"?s.lineWidth()>=n?(s.offsetX(e.UI_LEFT_TOP_X),s.offsetY(e.UI_LEFT_TOP_Y),s.lineLength(e.UI_RIGHT_BOTTOM_X-e.UI_LEFT_TOP_X)):(s.offsetX(e.UI_LEFT_TOP_X),s.offsetY(e.UI_LEFT_TOP_Y+(n-s.lineWidth())/2),s.lineLength(e.UI_RIGHT_BOTTOM_X-e.UI_LEFT_TOP_X)):s.lineType()=="v"&&(s.lineWidth()>=n?(s.offsetX(e.UI_LEFT_TOP_X),s.offsetY(e.UI_LEFT_TOP_Y),s.lineLength(e.UI_RIGHT_BOTTOM_Y-e.UI_LEFT_TOP_Y)):(s.offsetX(e.UI_LEFT_TOP_X+(n-s.lineWidth())/2),s.offsetY(e.UI_LEFT_TOP_Y),s.lineLength(e.UI_RIGHT_BOTTOM_Y-e.UI_LEFT_TOP_Y)))},owner:s}),s.init=function(){i=i||{};var e={include:["id","name","type","zIndex","offsetX","offsetY","angle","ratio","lineType","lineLength","lineWidth","lineColor"]};i&&t.fromJS(i,e,s),s.redraw()},s.updateCanvas=function(){s.redraw(),s.parent&&s.parent.updateCanvas()},s.resizeCanvas=function(e,t){s.cvs.width=e,s.cvs.height=t,s.cvs.style.width=e+"px",s.cvs.style.height=e+"px"},s.redraw=function(){return s.resizeCanvas(s.canvasWidth(),s.canvasHeight()),s.ctx.beginPath(),s.ctx.lineWidth=s.lineWidth(),s.ctx.strokeStyle=s.lineColor(),s.lineType()=="h"?(s.ctx.moveTo(0,s.lineWidth()/2),s.ctx.lineTo(s.lineLength(),s.lineWidth()/2)):s.lineType()=="v"&&(s.ctx.moveTo(s.lineWidth()/2,0),s.ctx.lineTo(s.lineWidth()/2,s.lineLength())),s.ctx.stroke(),s.cvs},s.isInPoint=function(e,t){e=e||window.app.stage.mouseX(),t=t||window.app.stage.mouseY();if(s.lineType()=="h")return s.lineWidth()>=n?s.offsetX()<=e&&e<=s.offsetX()+s.lineLength()&&s.offsetY()<=t&&t<=s.offsetY()+s.lineWidth():s.offsetX()<=e&&e<=s.offsetX()+s.lineLength()&&s.offsetY()-(n-s.lineWidth())/2<=t&&t<=s.offsetY()+s.lineWidth()+(n-s.lineWidth())/2;if(s.lineType()=="v")return s.lineWidth()>=n?s.offsetX()<=e&&e<=s.offsetX()+s.lineWidth()&&s.offsetY()<=t&&t<=s.offsetY()+s.lineLength():s.offsetX()-(n-s.lineWidth())/2<=e&&e<=s.offsetX()+s.lineWidth()+(n-s.lineWidth())/2&&s.offsetY()<=t&&t<=s.offsetY()+s.lineLength()},s.init()};return r});