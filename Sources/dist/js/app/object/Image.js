define(["knockout","mapping"],function(e,t){var n=function(n,r){var i=this;i.cvs=document.createElement("canvas"),i.ctx=i.cvs.getContext("2d"),i.parent=n,i.id=null,i.name=e.observable("图片"),i.type="image",i.zIndex=e.observable(0),i.offsetX=e.observable(20),i.offsetY=e.observable(20),i.angle=e.observable(0),i.ratio=e.observable(1),i.selected=e.observable(!1),i.width=e.observable(400),i.height=e.observable(300),i.loaded=e.observable(!1),i.dataURL=e.observable(),i.image=null,i.getImagecache=e.computed(function(){var e=new Image;return e.onload=function(){i.loaded(!0),i.image=e,i.width(e.width),i.height(e.height),i.updateCanvas()},e.src=i.dataURL(),!0}),i.UI_INFO=e.computed({read:function(){return{UI_LEFT_TOP_X:i.offsetX(),UI_LEFT_TOP_Y:i.offsetY(),UI_RIGHT_BOTTOM_X:i.offsetX()+i.width(),UI_RIGHT_BOTTOM_Y:i.offsetY()+i.height()}},write:function(e){i.offsetX(e.UI_LEFT_TOP_X),i.offsetY(e.UI_LEFT_TOP_Y),i.width(e.UI_RIGHT_BOTTOM_X-e.UI_LEFT_TOP_X),i.height(e.UI_RIGHT_BOTTOM_Y-e.UI_LEFT_TOP_Y)},owner:i}),i.init=function(){r=r||{};var e={ignore:["cvs","ctx","parent","loaded","image","getImagecache","UI_INFO"],include:["id","name","type","zIndex","offsetX","offsetY","angle","ratio","width","height","dataURL"]};r&&t.fromJS(r,e,i),i.redraw(),console.log(t.toJS(i))},i.updateCanvas=function(){i.redraw(),i.parent&&i.parent.updateCanvas()},i.resizeCanvas=function(e,t){i.cvs.width=e,i.cvs.height=t,i.cvs.style.width=e+"px",i.cvs.style.height=e+"px"},i.redraw=function(){return i.resizeCanvas(i.width(),i.height()),i.loaded()&&i.image?i.ctx.drawImage(i.image,0,0,i.width(),i.height()):(i.ctx.textBaseline="top",i.ctx.fillText("图片加载中...",0,0)),i.cvs},i.isInPoint=function(e,t){return e=e||window.app.stage.mouseX(),t=t||window.app.stage.mouseY(),i.offsetX()<=e&&e<=i.offsetX()+i.width()&&i.offsetY()<=t&&t<=i.offsetY()+i.height()},i.init()};return n});