/**
 * BC Math Library for Javascript
 * Ported from the PHP5 bcmath extension source code,
 * which uses the libbcmath package...
 *    Copyright (C) 1991, 1992, 1993, 1994, 1997 Free Software Foundation, Inc.
 *    Copyright (C) 2000 Philip A. Nelson
 *     The Free Software Foundation, Inc.
 *     59 Temple Place, Suite 330
 *     Boston, MA 02111-1307 USA.
 *      e-mail:  philnelson@acm.org
 *     us-mail:  Philip A. Nelson
 *               Computer Science Department, 9062
 *               Western Washington University
 *               Bellingham, WA 98226-9062
 *
 * bcmath-js homepage:
 *
 * This code is covered under the LGPL licence, and can be used however you want :)
 * Be kind and share any decent code changes.
 */

define([],function(){var e={PLUS:"+",MINUS:"-",BASE:10,scale:0,bc_num:function(){this.n_sign=null,this.n_len=null,this.n_scale=null,this.n_value=null,this.toString=function(){var t,n;return n=this.n_value.join(""),t=(this.n_sign==e.PLUS?"":this.n_sign)+n.substr(0,this.n_len),this.n_scale>0&&(t+="."+n.substr(this.n_len,this.n_scale)),t},this.setScale=function(e){while(this.n_scale<e)this.n_value.push(0),this.n_scale++;while(this.n_scale>e)this.n_value.pop(),this.n_scale--;return this}},bc_new_num:function(t,n){var r;return r=new e.bc_num,r.n_sign=e.PLUS,r.n_len=t,r.n_scale=n,r.n_value=e.safe_emalloc(1,t+n,0),e.memset(r.n_value,0,0,t+n),r},safe_emalloc:function(e,t,n){return Array(e*t+n)},bc_init_num:function(){return new e.bc_new_num(1,0)},_bc_rm_leading_zeros:function(e){while(e.n_value[0]===0&&e.n_len>1)e.n_value.shift(),e.n_len--},php_str2num:function(t){var n;return n=t.indexOf("."),n==-1?e.bc_str2num(t,0):e.bc_str2num(t,t.length-n)},CH_VAL:function(e){return e-"0"},BCD_CHAR:function(e){return e+"0"},isdigit:function(e){return isNaN(parseInt(e,10))?!1:!0},bc_str2num:function(t,n){var r,i,s,o,u,a,f;r=t.split(""),s=0,o=0,u=0,a=!1,(r[s]==="+"||r[s]==="-")&&s++;while(r[s]==="0")s++;while(r[s]%1===0)s++,o++;r[s]==="."&&s++;while(r[s]%1===0)s++,u++;if(r[s]||o+u===0)return e.bc_init_num();u=e.MIN(u,n),o===0&&(a=!0,o=1),i=e.bc_new_num(o,u),s=0,r[s]==="-"?(i.n_sign=e.MINUS,s++):(i.n_sign=e.PLUS,r[s]==="+"&&s++);while(r[s]==="0")s++;f=0,a&&(i.n_value[f++]=0,o=0);for(;o>0;o--)i.n_value[f++]=e.CH_VAL(r[s++]);if(u>0){s++;for(;u>0;u--)i.n_value[f++]=e.CH_VAL(r[s++])}return i},cint:function(e){typeof e=="undefined"&&(e=0);var t=parseInt(e,10);return isNaN(t)&&(t=0),t},MIN:function(e,t){return e>t?t:e},MAX:function(e,t){return e>t?e:t},ODD:function(e){return e&1},memset:function(e,t,n,r){var i;for(i=0;i<r;i++)e[t+i]=n},memcpy:function(e,t,n,r,i){var s;for(s=0;s<i;s++)e[t+s]=n[r+s];return!0},bc_is_zero:function(e){var t,n;t=e.n_len+e.n_scale,n=0;while(t>0&&e.n_value[n++]===0)t--;return t!==0?!1:!0},bc_out_of_memory:function(){throw new Error("(BC) Out of memory")}};e.bc_add=function(t,n,r){var i,s,o;if(t.n_sign===n.n_sign)i=e._bc_do_add(t,n,r),i.n_sign=t.n_sign;else{s=e._bc_do_compare(t,n,!1,!1);switch(s){case-1:i=e._bc_do_sub(n,t,r),i.n_sign=n.n_sign;break;case 0:o=e.MAX(r,e.MAX(t.n_scale,n.n_scale)),i=e.bc_new_num(1,o),e.memset(i.n_value,0,0,o+1);break;case 1:i=e._bc_do_sub(t,n,r),i.n_sign=t.n_sign}}return i},e.bc_compare=function(t,n){return e._bc_do_compare(t,n,!0,!1)},e._bc_do_compare=function(t,n,r,i){var s,o,u;if(r&&t.n_sign!=n.n_sign)return t.n_sign==e.PLUS?1:-1;if(t.n_len!=n.n_len)return t.n_len>n.n_len?!r||t.n_sign==e.PLUS?1:-1:!r||t.n_sign==e.PLUS?-1:1;u=t.n_len+Math.min(t.n_scale,n.n_scale),s=0,o=0;while(u>0&&t.n_value[s]==n.n_value[o])s++,o++,u--;if(i&&u==1&&t.n_scale==n.n_scale)return 0;if(u!==0)return t.n_value[s]>n.n_value[o]?!r||t.n_sign==e.PLUS?1:-1:!r||t.n_sign==e.PLUS?-1:1;if(t.n_scale!=n.n_scale)if(t.n_scale>n.n_scale){for(u=t.n_scale-n.n_scale;u>0;u--)if(t.n_value[s++]!==0)return!r||t.n_sign==e.PLUS?1:-1}else for(u=n.n_scale-t.n_scale;u>0;u--)if(n.n_value[o++]!==0)return!r||t.n_sign==e.PLUS?-1:1;return 0},e._one_mult=function(t,n,r,i,s,o){var u,a,f,l;if(i===0)e.memset(s,0,0,r);else if(i==1)e.memcpy(s,o,t,n,r);else{f=n+r-1,l=o+r-1,u=0;while(r-->0)a=t[f--]*i+u,s[l--]=a%e.BASE,u=Math.floor(a/e.BASE);u!=0&&(s[l]=u)}},e.bc_divide=function(t,n,r){var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k;if(e.bc_is_zero(n))return-1;if(e.bc_is_zero(t))return e.bc_new_num(1,r);n.n_scale===0&&n.n_len===1&&n.n_value[0]===1&&(s=e.bc_new_num(t.n_len,r),s.n_sign=t.n_sign==n.n_sign?e.PLUS:e.MINUS,e.memset(s.n_value,t.n_len,0,r),e.memcpy(s.n_value,0,t.n_value,0,t.n_len+e.MIN(t.n_scale,r))),m=n.n_scale,l=n.n_len+m-1;while(m>0&&n.n_value[l--]===0)m--;d=t.n_len+m,h=t.n_scale-m,h<r?y=r-h:y=0,o=e.safe_emalloc(1,t.n_len+t.n_scale,y+2),o===null&&e.bc_out_of_memory(),e.memset(o,0,0,t.n_len+t.n_scale+y+2),e.memcpy(o,1,t.n_value,0,t.n_len+t.n_scale),v=n.n_len+m,u=e.safe_emalloc(1,v,1),u===null&&e.bc_out_of_memory(),e.memcpy(u,0,n.n_value,0,v),u[v]=0,l=0;while(u[l]===0)l++,v--;v>d+r?(g=r+1,N=!0):(N=!1,v>d?g=r+1:g=d-v+r+1),s=e.bc_new_num(g-r,r),e.memset(s.n_value,0,0,g),T=e.safe_emalloc(1,v,1),T===null&&e.bc_out_of_memory();if(!N){C=Math.floor(10/(n.n_value[l]+1)),C!=1&&(e._one_mult(o,0,d+h+y+1,C,o,0),e._one_mult(n.n_value,l,v,C,n.n_value,l)),w=0,v>d?c=v-d:c=0;while(w<=d+r-v){n.n_value[l]==o[w]?E=9:E=Math.floor((o[w]*10+o[w+1])/n.n_value[l]),n.n_value[l+1]*E>(o[w]*10+o[w+1]-n.n_value[l]*E)*10+o[w+2]&&(E--,n.n_value[l+1]*E>(o[w]*10+o[w+1]-n.n_value[l]*E)*10+o[w+2]&&E--),S=0;if(E!==0){T[0]=0,e._one_mult(n.n_value,l,v,E,T,1),a=w+v,f=v;for(b=0;b<v+1;b++)f<0?p=o[a]-0-S:p=o[a]-T[f--]-S,p<0?(p+=10,S=1):S=0,o[a--]=p}if(S==1){E--,a=w+v,f=v-1,x=0;for(b=0;b<v;b++)f<0?p=o[a]+0+x:p=o[a]+n.n_value[f--]+x,p>9?(p-=10,x=1):x=0,o[a--]=p;x==1&&(o[a]=(o[a]+1)%10)}s.n_value[c++]=E,w++}}return s.n_sign=t.n_sign==n.n_sign?e.PLUS:e.MINUS,e.bc_is_zero(s)&&(s.n_sign=e.PLUS),e._bc_rm_leading_zeros(s),s},e._bc_do_add=function(t,n,r){var i,s,o,u,a,f,l,c,h,p;s=e.MAX(t.n_scale,n.n_scale),o=e.MAX(t.n_len,n.n_len)+1,i=e.bc_new_num(o,e.MAX(s,r)),c=t.n_scale,h=n.n_scale,u=t.n_len+c-1,a=n.n_len+h-1,f=s+o-1;if(c!=h)if(c>h)while(c>h)i.n_value[f--]=t.n_value[u--],c--;else while(h>c)i.n_value[f--]=n.n_value[a--],h--;c+=t.n_len,h+=n.n_len,l=0;while(c>0&&h>0)p=t.n_value[u--]+n.n_value[a--]+l,p>=e.BASE?(l=1,p-=e.BASE):l=0,i.n_value[f]=p,f--,c--,h--;if(c===0)while(h-->0)p=n.n_value[a--]+l,p>=e.BASE?(l=1,p-=e.BASE):l=0,i.n_value[f--]=p;else while(c-->0)p=t.n_value[u--]+l,p>=e.BASE?(l=1,p-=e.BASE):l=0,i.n_value[f--]=p;return l==1&&(i.n_value[f]+=1),e._bc_rm_leading_zeros(i),i},e._bc_do_sub=function(t,n,r){var i,s,o,u,a,f,l,c,h,p,d;o=e.MAX(t.n_len,n.n_len),s=e.MAX(t.n_scale,n.n_scale),a=e.MIN(t.n_len,n.n_len),u=e.MIN(t.n_scale,n.n_scale),i=e.bc_new_num(o,e.MAX(s,r)),f=t.n_len+t.n_scale-1,l=n.n_len+n.n_scale-1,c=o+s-1,h=0;if(t.n_scale!=u)for(p=t.n_scale-u;p>0;p--)i.n_value[c--]=t.n_value[f--];else for(p=n.n_scale-u;p>0;p--)d=0-n.n_value[l--]-h,d<0?(d+=e.BASE,h=1):(h=0,i.n_value[c--]=d);for(p=0;p<a+u;p++)d=t.n_value[f--]-n.n_value[l--]-h,d<0?(d+=e.BASE,h=1):h=0,i.n_value[c--]=d;if(o!=a)for(p=o-a;p>0;p--)d=t.n_value[f--]-h,d<0?(d+=e.BASE,h=1):h=0,i.n_value[c--]=d;return e._bc_rm_leading_zeros(i),i},e.MUL_BASE_DIGITS=80,e.MUL_SMALL_DIGITS=e.MUL_BASE_DIGITS/4,e.bc_multiply=function(t,n,r){var i,s,o,u,a;return s=t.n_len+t.n_scale,o=n.n_len+n.n_scale,u=t.n_scale+n.n_scale,a=e.MIN(u,e.MAX(r,e.MAX(t.n_scale,n.n_scale))),i=e._bc_rec_mul(t,s,n,o,u),i.n_sign=t.n_sign==n.n_sign?e.PLUS:e.MINUS,i.n_len=o+s+1-u,i.n_scale=a,e._bc_rm_leading_zeros(i),e.bc_is_zero(i)&&(i.n_sign=e.PLUS),i},e.new_sub_num=function(t,n,r){var i=new e.bc_num;return i.n_sign=e.PLUS,i.n_len=t,i.n_scale=n,i.n_value=r,i},e._bc_simp_mul=function(t,n,r,i,s){var o,u,a,f,l,c,h,p,d;d=n+i+1,o=e.bc_new_num(d,0),l=n-1,c=i-1,f=d-1,p=0;for(h=0;h<d-1;h++){u=l-e.MAX(0,h-i+1),a=c-e.MIN(h,i-1);while(u>=0&&a<=c)p+=t.n_value[u--]*r.n_value[a++];o.n_value[f--]=Math.floor(p%e.BASE),p=Math.floor(p/e.BASE)}return o.n_value[f]=p,o},e._bc_shift_addsub=function(t,n,r,i){var s,o,u,a;u=n.n_len,n.n_value[0]===0&&u--;if(t.n_len+t.n_scale>=r+u){s=t.n_len+t.n_scale-r-1,o=n.n_len=1,a=0;if(i){while(u--)t.n_value[s]-=n.n_value[o--]+a,t.n_value[s]<0?(a=1,t.n_value[s--]+=e.BASE):(a=0,s--);while(a)t.n_value[s]-=a,t.n_value[s]<0?t.n_value[s--]+=e.BASE:a=0}else{while(u--)t.n_value[s]+=n.n_value[o--]+a,t.n_value[s]>e.BASE-1?(a=1,t.n_value[s--]-=e.BASE):(a=0,s--);while(a)t.n_value[s]+=a,t.n_value[s]>e.BASE-1?t.n_value[s--]-=e.BASE:a=0}return!0}throw new Error("len + scale < shift + count")},e._bc_rec_mul=function(t,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S;return n+i<e.MUL_BASE_DIGITS||n<e.MUL_SMALL_DIGITS||i<e.MUL_SMALL_DIGITS?e._bc_simp_mul(t,n,r,i,s):(y=Math.floor((e.MAX(n,i)+1)/2),n<y?(a=e.bc_init_num(),u=e.new_sub_num(n,0,t.n_value)):(a=e.new_sub_num(n-y,0,t.n_value),u=e.new_sub_num(y,0,t.n_value+n-y)),i<y?(l=e.bc_init_num(),f=e.new_sub_num(i,0,r.n_value)):(l=e.new_sub_num(i-y,0,r.n_value),f=e.new_sub_num(y,0,r.n_value+i-y)),e._bc_rm_leading_zeros(a),e._bc_rm_leading_zeros(u),c=u.n_len,e._bc_rm_leading_zeros(l),e._bc_rm_leading_zeros(f),h=f.n_len,w=e.bc_is_zero(a)||e.bc_is_zero(l),m=e.bc_init_num(),g=e.bc_init_num(),m=e.bc_sub(a,u,0),E=m.n_len,g=e.bc_sub(f,l,0),S=g.n_len,w?p=e.bc_init_num():p=e._bc_rec_mul(a,a.n_len,l,l.n_len,0),e.bc_is_zero(m)||e.bc_is_zero(g)?d=e.bc_init_num():d=e._bc_rec_mul(m,E,g,S,0),e.bc_is_zero(u)||e.bc_is_zero(f)?v=e.bc_init_num():v=e._bc_rec_mul(u,u.n_len,f,f.n_len,0),b=n+i+1,o=e.bc_new_num(b,0),w||(e._bc_shift_addsub(o,p,2*y,0),e._bc_shift_addsub(o,p,y,0)),e._bc_shift_addsub(o,v,y,0),e._bc_shift_addsub(o,v,0,0),e._bc_shift_addsub(o,d,y,m.n_sign!=g.n_sign),o)},e.bc_sub=function(t,n,r){var i,s,o;if(t.n_sign!=n.n_sign)i=e._bc_do_add(t,n,r),i.n_sign=t.n_sign;else{s=e._bc_do_compare(t,n,!1,!1);switch(s){case-1:i=e._bc_do_sub(n,t,r),i.n_sign=n.n_sign==e.PLUS?e.MINUS:e.PLUS;break;case 0:o=e.MAX(r,e.MAX(t.n_scale,n.n_scale)),i=e.bc_new_num(1,o),e.memset(i.n_value,0,0,o+1);break;case 1:i=e._bc_do_sub(t,n,r),i.n_sign=t.n_sign}}return i};var t={bcadd:function(t,n,r){var i,s,o;return typeof r=="undefined"&&(r=e.scale),r=r<0?0:r,i=e.bc_init_num(),s=e.bc_init_num(),o=e.bc_init_num(),i=e.php_str2num(t.toString()),s=e.php_str2num(n.toString()),i.n_scale>s.n_scale&&s.setScale(i.n_scale),s.n_scale>i.n_scale&&i.setScale(s.n_scale),o=e.bc_add(i,s,r),o.n_scale>r&&(o.n_scale=r),o.toString()},bcsub:function(t,n,r){var i,s,o;return typeof r=="undefined"&&(r=e.scale),r=r<0?0:r,i=e.bc_init_num(),s=e.bc_init_num(),o=e.bc_init_num(),i=e.php_str2num(t.toString()),s=e.php_str2num(n.toString()),i.n_scale>s.n_scale&&s.setScale(i.n_scale),s.n_scale>i.n_scale&&i.setScale(s.n_scale),o=e.bc_sub(i,s,r),o.n_scale>r&&(o.n_scale=r),o.toString()},bccomp:function(t,n,r){var i,s;return typeof r=="undefined"&&(r=e.scale),r=r<0?0:r,i=e.bc_init_num(),s=e.bc_init_num(),i=e.bc_str2num(t.toString(),r),s=e.bc_str2num(n.toString(),r),e.bc_compare(i,s,r)},bcscale:function(t){return t=parseInt(t,10),isNaN(t)?!1:t<0?!1:(e.scale=t,!0)},bcdiv:function(t,n,r){var i,s,o;typeof r=="undefined"&&(r=e.scale),r=r<0?0:r,i=e.bc_init_num(),s=e.bc_init_num(),o=e.bc_init_num(),i=e.php_str2num(t.toString()),s=e.php_str2num(n.toString()),i.n_scale>s.n_scale&&s.setScale(i.n_scale),s.n_scale>i.n_scale&&i.setScale(s.n_scale),o=e.bc_divide(i,s,r);if(o===-1)throw new Error(11,"(BC) Division by zero");return o.n_scale>r&&(o.n_scale=r),o.toString()},bcmul:function(t,n,r){var i,s,o;return typeof r=="undefined"&&(r=e.scale),r=r<0?0:r,i=e.bc_init_num(),s=e.bc_init_num(),o=e.bc_init_num(),i=e.php_str2num(t.toString()),s=e.php_str2num(n.toString()),i.n_scale>s.n_scale&&s.setScale(i.n_scale),s.n_scale>i.n_scale&&i.setScale(s.n_scale),o=e.bc_multiply(i,s,r),o.n_scale>r&&(o.n_scale=r),o.toString()},bcround:function(e,t){var n,r;return n="0."+Array(t+1).join("0")+"5",e.toString().substring(0,1)=="-"&&(n="-"+n),r=bcadd(e,n,t),r}};return t});