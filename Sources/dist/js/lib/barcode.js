/*!
 *  BarCode Coder Library (BCC Library)
 *  BCCL Version 2.0
 *    
 *  Porting : jQuery barcode plugin 
 *  Version : 2.0.3
 *   
 *  Date    : 2013-01-06
 *  Author  : DEMONTE Jean-Baptiste <jbdemonte@gmail.com>
 *            HOUREZ Jonathan
 *             
 *  Web site: http://barcode-coder.com/
 *  dual licence :  http://www.cecill.info/licences/Licence_CeCILL_V2-fr.html
 *                  http://www.gnu.org/licenses/gpl.html
 */

define(["jquery","lib/pdf417","lib/qrcode"],function(e,t,n){var r=function(e){this.sources=null,this.init(e)};r.prototype={init:function(e){this.sources=e},getRowsCount:function(){return this.sources.length},getColsCount:function(){return this.sources[0].length},isDark:function(e,t){return this.sources[e][t]}};var s={settings:{barWidth:1,barHeight:50,moduleSize:5,showHRI:!0,addQuietZone:!0,marginHRI:5,bgColor:"#FFFFFF",color:"#000000",fontSize:10,output:"css",posX:0,posY:0},intval:function(e){var t=typeof e;return t=="string"?(e=e.replace(/[^0-9-.]/g,""),e=parseInt(e*1,10),isNaN(e)||!isFinite(e)?0:e):t=="number"&&isFinite(e)?Math.floor(e):0},i25:{encoding:["NNWWN","WNNNW","NWNNW","WWNNN","NNWNW","WNWNN","NWWNN","NNNWW","WNNWN","NWNWN"],compute:function(e,t,n){if(!t)e.length%2!=0&&(e="0"+e);else{n=="int25"&&e.length%2==0&&(e="0"+e);var r=!0,i,o=0;for(var u=e.length-1;u>-1;u--){i=s.intval(e.charAt(u));if(isNaN(i))return"";o+=r?3*i:i,r=!r}e+=((10-o%10)%10).toString()}return e},getDigit:function(e,t,n){e=this.compute(e,t,n);if(e=="")return"";result="";var i,o;if(n=="int25"){result+="1010";var u,a;for(i=0;i<e.length/2;i++){u=e.charAt(2*i),a=e.charAt(2*i+1);for(o=0;o<5;o++)result+="1",this.encoding[u].charAt(o)=="W"&&(result+="1"),result+="0",this.encoding[a].charAt(o)=="W"&&(result+="0")}result+="1101"}else if(n=="std25"){result+="11011010";var f;for(i=0;i<e.length;i++){f=e.charAt(i);for(o=0;o<5;o++)result+="1",this.encoding[f].charAt(o)=="W"&&(result+="11"),result+="0"}result+="11010110"}return new r(s.bitStringTo2DArray(result))}},ean:{encoding:[["0001101","0100111","1110010"],["0011001","0110011","1100110"],["0010011","0011011","1101100"],["0111101","0100001","1000010"],["0100011","0011101","1011100"],["0110001","0111001","1001110"],["0101111","0000101","1010000"],["0111011","0010001","1000100"],["0110111","0001001","1001000"],["0001011","0010111","1110100"]],first:["000000","001011","001101","001110","010011","011001","011100","010101","010110","011010"],getDigit:function(e,t){var n=t=="ean8"?7:12;e=e.substring(0,n);if(e.length!=n)return"";var i;for(var o=0;o<e.length;o++){i=e.charAt(o);if(i<"0"||i>"9")return""}e=this.compute(e,t);var u="101";if(t=="ean8"){for(var o=0;o<4;o++)u+=this.encoding[s.intval(e.charAt(o))][0];u+="01010";for(var o=4;o<8;o++)u+=this.encoding[s.intval(e.charAt(o))][2]}else{var a=this.first[s.intval(e.charAt(0))];for(var o=1;o<7;o++)u+=this.encoding[s.intval(e.charAt(o))][s.intval(a.charAt(o-1))];u+="01010";for(var o=7;o<13;o++)u+=this.encoding[s.intval(e.charAt(o))][2]}return u+="101",new r(s.bitStringTo2DArray(u))},compute:function(e,t){var n=t=="ean13"?12:7;e=e.substring(0,n);var r=0,o=!0;for(i=e.length-1;i>-1;i--)r+=(o?3:1)*s.intval(e.charAt(i)),o=!o;return e+((10-r%10)%10).toString()}},upc:{getDigit:function(e){return e.length<12?e="0"+e:e="0"+e.substr(0,11),console.log(e),s.ean.getDigit(e,"ean13")},compute:function(e){return e.length<12&&(e="0"+e),s.ean.compute(e,"ean13").substr(1)}},msi:{encoding:["100100100100","100100100110","100100110100","100100110110","100110100100","100110100110","100110110100","100110110110","110100100100","110100100110"],compute:function(e,t){return typeof t=="object"?(t.crc1=="mod10"?e=this.computeMod10(e):t.crc1=="mod11"&&(e=this.computeMod11(e)),t.crc2=="mod10"?e=this.computeMod10(e):t.crc2=="mod11"&&(e=this.computeMod11(e))):typeof t=="boolean"&&t&&(e=this.computeMod10(e)),e},computeMod10:function(e){var t,n=e.length%2,r=0,i=0;for(t=0;t<e.length;t++)n?r=10*r+s.intval(e.charAt(t)):i+=s.intval(e.charAt(t)),n=!n;var o=(2*r).toString();for(t=0;t<o.length;t++)i+=s.intval(o.charAt(t));return e+((10-i%10)%10).toString()},computeMod11:function(e){var t=0,n=2;for(var r=e.length-1;r>=0;r--)t+=n*s.intval(e.charAt(r)),n=n==7?2:n+1;return e+((11-t%11)%11).toString()},getDigit:function(e,t){var n="0123456789",o=0,u="";e=this.compute(e,!1),u="110";for(i=0;i<e.length;i++){o=n.indexOf(e.charAt(i));if(o<0)return"";u+=this.encoding[o]}return u+="1001",new r(s.bitStringTo2DArray(u))}},code11:{encoding:["101011","1101011","1001011","1100101","1011011","1101101","1001101","1010011","1101001","110101","101101"],getDigit:function(e){var t="0123456789-",n,i,o="",u="0";o="1011001"+u;for(n=0;n<e.length;n++){i=t.indexOf(e.charAt(n));if(i<0)return"";o+=this.encoding[i]+u}var a=0,f=0,l=1,c=0;for(n=e.length-1;n>=0;n--)a=a==10?1:a+1,l=l==10?1:l+1,i=t.indexOf(e.charAt(n)),f+=a*i,c+=l*i;var h=f%11;c+=h;var p=c%11;return o+=this.encoding[h]+u,e.length>=10&&(o+=this.encoding[p]+u),o+="1011001",new r(s.bitStringTo2DArray(o))}},code39:{encoding:["101001101101","110100101011","101100101011","110110010101","101001101011","110100110101","101100110101","101001011011","110100101101","101100101101","110101001011","101101001011","110110100101","101011001011","110101100101","101101100101","101010011011","110101001101","101101001101","101011001101","110101010011","101101010011","110110101001","101011010011","110101101001","101101101001","101010110011","110101011001","101101011001","101011011001","110010101011","100110101011","110011010101","100101101011","110010110101","100110110101","100101011011","110010101101","100110101101","100100100101","100100101001","100101001001","101001001001","100101101101"],getDigit:function(e){var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%*",n,i,o="",u="0";if(e.indexOf("*")>=0)return"";e=("*"+e+"*").toUpperCase();for(n=0;n<e.length;n++){i=t.indexOf(e.charAt(n));if(i<0)return"";n>0&&(o+=u),o+=this.encoding[i]}return new r(s.bitStringTo2DArray(o))}},code93:{encoding:["100010100","101001000","101000100","101000010","100101000","100100100","100100010","101010000","100010010","100001010","110101000","110100100","110100010","110010100","110010010","110001010","101101000","101100100","101100010","100110100","100011010","101011000","101001100","101000110","100101100","100010110","110110100","110110010","110101100","110100110","110010110","110011010","101101100","101100110","100110110","100111010","100101110","111010100","111010010","111001010","101101110","101110110","110101110","100100110","111011010","111010110","100110010","101011110"],getDigit:function(e,t){var n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%____*",o,u="";if(e.indexOf("*")>=0)return"";e=e.toUpperCase(),u+=this.encoding[47];for(i=0;i<e.length;i++){o=e.charAt(i),index=n.indexOf(o);if(o=="_"||index<0)return"";u+=this.encoding[index]}if(t){var a=0,f=0,l=1,c=0;for(i=e.length-1;i>=0;i--)a=a==20?1:a+1,l=l==15?1:l+1,index=n.indexOf(e.charAt(i)),f+=a*index,c+=l*index;var o=f%47;c+=o;var h=c%47;u+=this.encoding[o],u+=this.encoding[h]}return u+=this.encoding[47],u+="1",new r(s.bitStringTo2DArray(u))}},code128:{encoding:["11011001100","11001101100","11001100110","10010011000","10010001100","10001001100","10011001000","10011000100","10001100100","11001001000","11001000100","11000100100","10110011100","10011011100","10011001110","10111001100","10011101100","10011100110","11001110010","11001011100","11001001110","11011100100","11001110100","11101101110","11101001100","11100101100","11100100110","11101100100","11100110100","11100110010","11011011000","11011000110","11000110110","10100011000","10001011000","10001000110","10110001000","10001101000","10001100010","11010001000","11000101000","11000100010","10110111000","10110001110","10001101110","10111011000","10111000110","10001110110","11101110110","11010001110","11000101110","11011101000","11011100010","11011101110","11101011000","11101000110","11100010110","11101101000","11101100010","11100011010","11101111010","11001000010","11110001010","10100110000","10100001100","10010110000","10010000110","10000101100","10000100110","10110010000","10110000100","10011010000","10011000010","10000110100","10000110010","11000010010","11001010000","11110111010","11000010100","10001111010","10100111100","10010111100","10010011110","10111100100","10011110100","10011110010","11110100100","11110010100","11110010010","11011011110","11011110110","11110110110","10101111000","10100011110","10001011110","10111101000","10111100010","11110101000","11110100010","10111011110","10111101110","11101011110","11110101110","11010000100","11010010000","11010011100","11000111010"],getDigit:function(e){var t=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",n="",i=0,o=0,u=0,a=0,f=0;for(u=0;u<e.length;u++)if(t.indexOf(e.charAt(u))==-1)return"";var l=e.length>1,c="";for(u=0;u<3&&u<e.length;u++)c=e.charAt(u),l&=c>="0"&&c<="9";i=l?105:104,n=this.encoding[i],u=0;while(u<e.length){if(!l){a=0;while(u+a<e.length&&e.charAt(u+a)>="0"&&e.charAt(u+a)<="9")a++;l=a>5||u+a-1==e.length&&a>3,l&&(n+=this.encoding[99],i+=++o*99)}else if(u==e.length||e.charAt(u)<"0"||e.charAt(u)>"9"||e.charAt(u+1)<"0"||e.charAt(u+1)>"9")l=!1,n+=this.encoding[100],i+=++o*100;l?(f=s.intval(e.charAt(u)+e.charAt(u+1)),u+=2):(f=t.indexOf(e.charAt(u)),u+=1),n+=this.encoding[f],i+=++o*f}return n+=this.encoding[i%103],n+=this.encoding[106],n+="11",new r(s.bitStringTo2DArray(n))}},codabar:{encoding:["101010011","101011001","101001011","110010101","101101001","110101001","100101011","100101101","100110101","110100101","101001101","101100101","1101011011","1101101011","1101101101","1011011011","1011001001","1010010011","1001001011","1010011001"],getDigit:function(e){var t="0123456789-$:/.+",n,i,o="",u="0";o+=this.encoding[16]+u;for(n=0;n<e.length;n++){i=t.indexOf(e.charAt(n));if(i<0)return"";o+=this.encoding[i]+u}return o+=this.encoding[16],new r(s.bitStringTo2DArray(o))}},lec:{cInt:function(e,t){var n="";for(var r=0;r<t;r++)n+=String.fromCharCode(e&255),e>>=8;return n},cRgb:function(e,t,n){return String.fromCharCode(n)+String.fromCharCode(t)+String.fromCharCode(e)},cHexColor:function(e){var t=parseInt("0x"+e.substr(1)),n=t&255;t>>=8;var r=t&255,i=t>>8;return this.cRgb(i,r,n)}},pdf417:{getDigit:function(e){return t.init(e),new r(t.getBarcodeArray().bcode)}},qrcode:{getDigit:function(e,t,r,i){var i=i||1,s=40;for(var o=i;o<=s;o+=1)try{var u=n(o,r);return u.addData(e),u.make(),u}catch(a){}}},hexToRGB:function(e){var t=parseInt("0x"+e.substr(1)),n=t&255;t>>=8;var r=t&255,i=t>>8;return{r:i,g:r,b:n}},isHexColor:function(e){var t=new RegExp("#[0-91-F]","gi");return e.match(t)},base64Encode:function(e){var t="",n,r,i,s,o,u,a,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=0;while(l<e.length)n=e.charCodeAt(l++),r=e.charCodeAt(l++),i=e.charCodeAt(l++),s=n>>2,o=(n&3)<<4|r>>4,u=(r&15)<<2|i>>6,a=i&63,isNaN(r)?u=a=64:isNaN(i)&&(a=64),t+=f.charAt(s)+f.charAt(o)+f.charAt(u)+f.charAt(a);return t},bitStringTo2DArray:function(e){var t=[];t[0]=[];for(var n=0;n<e.length;n++)t[0][n]=e.charAt(n)=="1"?!0:!1;return t}};return s});